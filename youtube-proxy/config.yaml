# youtube-proxy configuration

dns:
  listen: "10.8.0.2:53"
  upstream: "1.1.1.1:53"
  # IP-адрес прокси, который будет отдаваться клиентам (IP VPS2 внутри туннеля)
  # intercept_ip: "10.8.0.2"
  # Домены, которые перехватываются прокси.
  # ОТКЛЮЧЕНО: перехват YouTube-доменов ломает YouTube-приложение на iOS из-за certificate pinning.
  # Чтобы включить MITM-перехват обратно — раскомментируйте intercept_ip и intercept_hosts.
  # intercept_hosts:
  #   - "youtubei.googleapis.com"
  #   - "m.youtube.com"
  #   - "www.youtube.com"
  # Встроенные блок-листы (загружаются при старте)
  blocklists:
    - path: "blocklists/ads.txt"
      comment: "Рекламные домены"
    - path: "blocklists/tracking.txt"
      comment: "Трекинг"
    - path: "blocklists/malware.txt"
      comment: "Malware"
  # Дополнительные URL для загрузки блок-листов (обновляются раз в сутки)
  blocklist_urls:
    - "https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt"
    - "https://raw.githubusercontent.com/nicehash/NiceHashQuickMiner/master/filters/blocklist.txt"
    - "https://raw.githubusercontent.com/hagezi/dns-blocklists/main/hosts/pro.txt"
    - "https://raw.githubusercontent.com/blocklistproject/Lists/master/ads.txt"
    - "https://raw.githubusercontent.com/blocklistproject/Lists/master/tracking.txt"

proxy:
  listen: "10.8.0.2:443"
  # Путь к сертификатам (генерируются автоматически при первом запуске)
  ca_cert: "certs/ca.crt"
  ca_key:  "certs/ca.key"
  server_cert: "certs/server.crt"
  server_key:  "certs/server.key"
  # Реальный upstream для перехватываемых доменов
  upstream_host: "youtubei.googleapis.com:443"
  # IP-адреса сервера для IP SAN в серверном сертификате.
  # Добавьте WAN IP и VPN IP VPS2, чтобы прямые запросы по IP не давали ошибку TLS.
  server_ips:
    - "10.8.0.2"
    - "38.135.122.81"
  # MITM-перехват YouTube-трафика отключён (intercept_hosts убран из dns секции).
  # Прокси слушает только на VPN-интерфейсе и фильтрует JSON-ответы по ключам из filter.endpoints.
  # Чтобы включить MITM обратно — добавьте intercept_ip и intercept_hosts в секцию dns.

filter:
  # Эндпоинты, из которых вырезается реклама
  endpoints:
    - path: "/youtubei/v1/player"
      remove_keys:
        - "playerAds"
        - "adPlacements"
        - "adSlots"
        - "adBreakHeartbeatParams"
        - "adBreakParams"
        - "playerLegacyDesktopWatchAdsRenderer"
        - "adBreakServiceRenderer"
        - "instreamVideoAdRenderer"
        - "linearAdSequenceRenderer"
        - "adLayoutMetadata"
        - "playerAdParams"
        - "actionCompanionAdRenderer"
        - "reelPlayerAdRenderer"
    - path: "/youtubei/v1/next"
      remove_keys:
        - "adSlots"
        - "promotedSparklesTextSearchRenderer"
        - "searchPyvRenderer"
        - "promotedVideoRenderer"
        - "adComponentRenderer"
        - "bannerPromoRenderer"
        - "mastHeadAdRenderer"
        - "reelPlayerAdRenderer"
    - path: "/youtubei/v1/browse"
      remove_keys:
        - "adSlots"
        - "promotedVideoRenderer"
        - "searchPyvRenderer"
        - "adComponentRenderer"
        - "promotedSparklesTextSearchRenderer"
        - "mastHeadAdRenderer"
        - "bannerPromoRenderer"
    - path: "/youtubei/v1/search"
      remove_keys:
        - "adSlots"
        - "promotedVideoRenderer"
        - "searchPyvRenderer"
        - "adComponentRenderer"
        - "promotedSparklesTextSearchRenderer"
    - path: "/youtubei/v1/reel/reel_watch_sequence"
      remove_keys:
        - "adSlots"
        - "reelPlayerAdRenderer"
        - "adComponentRenderer"

ca_server:
  # HTTP-сервер для скачивания Root CA сертификата
  # Слушает только на VPN-интерфейсе — доступен лишь клиентам внутри туннеля
  listen: "10.8.0.2:8080"
  cert_path: "certs/ca.crt"
