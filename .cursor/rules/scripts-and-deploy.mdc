---
description: Системное правило проекта: инженерные принципы, работа через скрипты, тесты, безопасность и консистентная поставка изменений
alwaysApply: true
---

# Системный стандарт проекта

Этот документ задает обязательные правила разработки и эксплуатации.  
Цель: предсказуемые изменения, высокая надежность, безопасность, воспроизводимость и единый инженерный стиль.

## 1) Базовые принципы

1. **Системность вместо ручного вмешательства**  
   Любое существенное изменение оформляется как повторяемый сценарий, а не как разовая последовательность команд.

2. **Воспроизводимость**  
   Один и тот же вход должен давать один и тот же результат в локальной среде, CI и на сервере.

3. **Безопасность по умолчанию**  
   Любой шаг выполняется с минимально необходимыми правами, без утечки секретов и без опасных операций "по умолчанию".

4. **Наблюдаемость и проверяемость**  
   Результат изменения должен быть проверяем тестами, логами и явными критериями успеха.

5. **Консистентность проекта**  
   Новые решения не должны ломать существующие соглашения по структуре, именованию, деплою и документации.

## 2) Запрещено

- Выполнять изменение вручную по одной команде, если это изменение можно и нужно оформить скриптом.
- Проводить деплой или миграции без заранее подготовленного и проверенного сценария.
- Вносить изменения без тестового покрытия затронутой логики.
- Менять поведение системы без синхронного обновления документации.
- Логировать, коммитить или публиковать секреты (`.env`, ключи, токены, приватные сертификаты).

## 3) Обязательный формат внесения изменений

1. **Скрипт как единица поставки**  
   Изменения выполняются через готовый скрипт: обновление существующего (`deploy.sh`, `deploy-vps1.sh`, `deploy-vps2.sh`, `deploy-proxy.sh`) или создание нового сценария.

2. **Полный рабочий контур**  
   Скрипт должен включать весь процесс: подготовка, валидация входов, выполнение, проверка результата, понятный код выхода.

3. **Идемпотентность и безопасный повторный запуск**  
   Повторный запуск не должен приводить к повреждению состояния или дублированию критичных действий.

4. **Явные pre-check/post-check**  
   До запуска: проверки зависимостей, окружения и прав.  
   После запуска: проверка успешности, доступности сервиса и ключевых инвариантов.

5. **Один запуск как способ применения**  
   Изменение считается примененным только через единый запуск подготовленного скрипта/программы.

## 4) Требования к тестам

- У каждого нового или измененного скрипта обязательно есть тесты (unit/integration/e2e, где уместно).
- Тесты должны проверять позитивный сценарий, типовые ошибки и безопасное поведение при повторном запуске.
- Перед применением изменения тесты должны быть выполнены и давать успешный результат.
- Если тест автоматизировать временно невозможно, нужен документированный временный протокол ручной проверки с планом автоматизации.

## 5) Требования к документации

- Любое изменение, затрагивающее поведение, конфигурацию, запуск, деплой, восстановление или архитектурные договоренности, требует обновления документации.
- Минимум: что изменилось, зачем, как запускать, как проверять, как откатывать.
- README, правила, комментарии и конфиги должны оставаться синхронизированными с фактической реализацией.

## 6) Качество и инженерная дисциплина

- Предпочитать простые и надежные решения, а не сложные и хрупкие.
- Сохранять обратную совместимость там, где это возможно и рационально.
- Не смешивать несвязанные изменения в одной поставке.
- Явно фиксировать допущения, риски и ограничения.
- Для потенциально опасных операций предусматривать "dry-run", подтверждения или защитные проверки.

## 7) Минимальный Definition of Done

Изменение считается завершенным только если выполнены все пункты:

- Подготовлен или обновлен рабочий скрипт применения изменения.
- Для скрипта добавлены/обновлены тесты и они успешно проходят.
- Документация обновлена и соответствует новому поведению.
- Изменение применено единым сценарием (а не набором ручных команд).
- Нет известных критичных регрессий, безопасность не ухудшена.

## 8) Правило приоритетов

При конфликте решений приоритет такой:

1. Безопасность и целостность данных.
2. Воспроизводимость и проверяемость.
3. Стабильность эксплуатации.
4. Скорость внедрения.

Если быстрый путь нарушает приоритеты 1-3, он не используется.

## 9) Операционное резюме

Любая доработка в проекте выполняется как **инженерный сценарий**, а не как "ручной набор действий":  
**скрипт + тесты + документация + единый запуск + проверка результата**.
